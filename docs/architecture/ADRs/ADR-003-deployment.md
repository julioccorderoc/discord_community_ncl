# ADR-003 — Deployment Platform: Railway

**Status:** Accepted
**Date:** 2026-02-21
**Deciders:** Project Lead

---

## Context

The project consists of two long-running Python processes:

1. **Discord bot** (`main.py`) — maintains a persistent WebSocket connection to Discord. Must run 24/7. Cannot tolerate cold-starts or sleep. **Serverless platforms are incompatible.**
2. **Streamlit dashboard** (`src/dashboard/app.py`) — an internal web application. Can tolerate occasional cold-starts.

Both processes share a Supabase database (already hosted; not in scope for this decision).

Several deployment options were evaluated:

| Option | Cost | Persistent process | DX | Notes |
|---|---|---|---|---|
| Railway | ~$0–2/mo (free credit) | Yes | High | Git-push, uv native, two services |
| Fly.io + Streamlit Cloud | $0 | Yes / Yes | Medium | Two platforms to manage |
| Oracle Cloud Free Tier | $0 | Yes | Low | SSH + systemd required |
| Render | $7/mo | Yes (paid only) | High | Free tier sleeps after 15 min inactivity |
| Heroku | $7–12/mo | Yes | High | Free tier removed in 2022 |
| Serverless (Lambda, Cloud Run) | ~$0 | No | N/A | Incompatible with Discord WebSocket |

---

## Decision

**Deploy on Railway** using two services within a single Railway Project.

- **`bot` service** — Worker (no HTTP port), start command: `uv run python main.py`
- **`dashboard` service** — Web Service (public URL), start command: `uv run streamlit run src/dashboard/app.py --server.port $PORT --server.address 0.0.0.0`

Railway was chosen because:

1. **Persistent processes** — Workers run indefinitely; no sleep policy
2. **`uv` native support** — Railway detects `pyproject.toml` and runs `uv sync` automatically; no Dockerfile required
3. **Simplest DX** — git-push-to-deploy, environment variables in the UI, logs in the dashboard
4. **Free credit covers this workload** — $5/month credit is sufficient for two small services at this scale
5. **Single platform** — both services managed in one place; shared environment variables via Project Variables

---

## Consequences

- `uv.lock` **must be committed** to the repository — Railway uses it to reproduce the exact dependency graph
- A public domain is generated by Railway for the dashboard; the bot service has no public URL
- Environment variables are managed exclusively in the Railway UI — **`.env` is never uploaded to Railway**
- `.env.example` in the repo root is the authoritative list of required variables for both services
- Per-deploy downtime for the bot is ~5–10 seconds (container replacement); this is acceptable for an internal community tool
- If Railway's pricing changes, the next evaluated option is Fly.io (bot) + Streamlit Community Cloud (dashboard)

---

## Full deployment instructions

See `docs/deployment/railway.md`.
